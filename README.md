# Testes unitários - Jogo de truco
**Trabalho 2 da disciplina de Qualidade de Software - 25/2:** desenvolvimento de testes automatizados para o código de um jogo de truco em Python, utilizando Pytest

Isadora Spohr e Nathália Almeida

## Estrutura dos testes
Todos os códigos desenvolvidos estão disponíveis na pasta [testes](https://github.com/fennerspohr/qs-testes-truco-25-2/tree/main/testes), separados em um arquivo por classe do programa. Dentro de cada um estão todos os testes relativos aos métodos da respectiva classe.

Além disso, foi adicionado ao código original um arquivo [logica.py](https://github.com/fennerspohr/qs-testes-truco-25-2/blob/main/truco/logica.py) que separa em métodos a main do programa, permitindo que seja testada.

Para executar os testes é preciso instalar o pytest e o pytest-mock, e depois rodar:

`pytest ./testes`

Uma parte dos testes é dependente do estado atual dos CSVs do programa, que são parte do algoritmo de decisão do bot. Portanto é preciso que estejam no estado atual para que os testes funcionem corretamente.

## Resultados
Ao total, foram desenvolvidos 138 testes, dos quais 8 apresentaram falha.

### test__main.py
*test_turno_do_bot1*: falha ocorre quando é simulada uma tentativa do bot pedir flor. O erro ocorre porque um método chamado da classe Cbr não existe.

*test_turno_do_bot4*: o erro ocorre por conta de um possível loop infinito: se nenhum jogador tiver pedido flor e o bot tentar pedir para ir ao baralho, o código executado é de real envido.

### test_bot.py
*test_calcular_qualidade_mao*: a função é responsável por realizar uma média harmônica para determinar a qualidade da mão do bot, porém o resultado do cálculo não é correto.
### test_jogo.py
*test_verificar_carta_vencedora*: nesse método não há um retorno para quando há empate de manilhas.
### test_truco.py
*test_controlador_truco*: ao solicitar "vale quatro", o programa executa um "retruco" e não atualiza o estado corretamente.

*test_pedir_vale_quatro*: não atualiza o estado para "vale_quatro".

*test_retornar_quem_fugiu*: o método chama ele mesmo ao invés de acessar o atributo "truco.quem_fugiu".

*test_resetar*: não reseta os valores corretamente.

### Demais problemas
Além dos testes com falhas, o código também apresenta problemas de padronização e organização, como: 
* Diversos métodos possuem parâmetros e variáveis não utilizadas;
* O método "avaliar_pedir_envido" da classe Bot não possui implementação, retornando sempre 1;
* Diversos métodos da classe Carta deveriam ser estáticos, ou então exigir um parâmetro a menos, pois solicitam tanto o *self* como outras duas instâncias de Carta;
* Os estados do programa são implementados com números mágicos, sem descrição através de constantes ou enums;
* Métodos da classe Dados tem nomes ambíguos que dificultam o entendimento;
* Muitas funções são extremamente longas e realizam muitas funcionalidades que poderiam ser divididas em métodos menores, ou que não são diretamente relacionadas com seu objetivo principal (exemplo: o método mostrar_opcoes da classe Jogador também atualiza o atributo flor);
* Pouca validação de entradas;

### Regras de negócio
Para uma primeira entrega parcial, estabelecemos requisitos e regras de negócio que deveriam ser validados pelos testes. O resultado das regras de negócio foi:

| ID     | Nome                                                                                            | Descrição                                                                                                                                                                                                                                                                                                                                                                                                                              | Resultado                                                                                                                                            |
|--------|-------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| [RN01] | <!--td {border: 1px solid #cccccc;}br {mso-data-placement:same-cell;}--> Valor máximo de aposta | <!--td {border: 1px solid #cccccc;}br {mso-data-placement:same-cell;}--> A aposta máxima de truco é de 4 pontos.                                                                                                                                                                                                                                                                                                                       | Parcial. Nao possui validaçao direta do valor de aposta.                                                                                             |
| [RN02] | <!--td {border: 1px solid #cccccc;}br {mso-data-placement:same-cell;}--> Validação da flor      | A flor deve ser chamada antes do final da primeira rodada, na vez do próprio jogador, e os pontos só serão recebidos se o jogador apresentar as 3 cartas ao final da mão. Vale 3 pontos                                                                                                                                                                                                                                                |  Parcial. Apresenta problemas de execuçao no caso do bot.                                                                                            |
| [RN03] | Validação contra flor                                                                           | A contra flor é uma resposta à flor, na qual o adversário também tem uma flor na mão, e inicia uma disputa. O vencedor só ganhará os pontos se apresentar as 3 cartas ao final da mão. Vale 6 pontos                                                                                                                                                                                                                                   | Passou                                                                                                                                               |
| [RN04] | Validação contra flor e o resto                                                                 | A contra flor e o resto é uma resposta à flor, na qual o adversário também tem uma flor na mão, e inicia uma disputa. O vencedor só ganhará os pontos se apresentar as 3 cartas ao final da mão. O vencedor recebe a quantidade de pontos faltantes para que ganhe o jogo.                                                                                                                                                             | Passou                                                                                                                                               |
| [RN05] | Validação truco                                                                                 | O truco deve ser pedido na vez do jogador. Aumenta o valor da mão para 2 pontos. Caso recusado, o solicitante recebe 1 ponto e encerra a mão                                                                                                                                                                                                                                                                                           | Passou                                                                                                                                               |
| [RN06] | Validação retruco                                                                               | O retruco é uma resposta ao truco. Aumenta o valor da mão para 3 pontos. Caso recusado, o solicitante recebe 2 pontos e encerra a mão                                                                                                                                                                                                                                                                                                  | Passou                                                                                                                                               |
| [RN07] | Validação vale quatro                                                                           | O vale quatro é uma resposta ao retruco. Aumenta o valor da mão para 4 pontos. Caso recusado, o solicitante recebe 3 pontos e encerra a mão                                                                                                                                                                                                                                                                                            |  Nao passou. Apresenta problemas na execuçao.                                                                                                        |
| [RN08] | Validação envido                                                                                | O envido deve ser pedido na primeira rodada, na vez do próprio jogador, antes dele jogar uma carta. Não é possível pedir envido caso haja uma chamada de flor, e qualquer disputa de envido é desfeita se uma flor for chamada posteriormente. Vale 2 pontos. Caso o adversário recuse, o solicitante ganha 1 ponto. Caso aceite, o solicitante deve mostrar as cartas no final da mão.                                                | Passou                                                                                                                                               |
| [RN09] | Validação real envido                                                                           | O real envido é uma resposta ao envido. Vale 5 pontos. Caso o adversário recuse, o solicitante ganha 1 ponto.                                                                                                                                                                                                                                                                                                                          |  Nao Passou. <!--td {border: 1px solid #cccccc;}br {mso-data-placement:same-cell;}--> Permite pedir real envido sem ter pedido envido                |
| [RN10] | Validação falta envido                                                                          | O falta envido é uma resposta ao real envido. O vencedor da disputa ganha todos os pontos faltantes para ganhar o jogo. Caso o adversário recuse, o solicitante ganha 1 ponto                                                                                                                                                                                                                                                          | Nao Passou. <!--td {border: 1px solid #cccccc;}br {mso-data-placement:same-cell;}--> Permite pedir falta envido sem ter pedido envido ou real envido |
| [RN11] | Vitória                                                                                         | Vence quem atingir 12 pontos primeiro                                                                                                                                                                                                                                                                                                                                                                                                  | Passou                                                                                                                                               |
| [RN12] | Empate da rodada                                                                                | Em caso de empate, vence a mão quem ganhou a primeira rodada                                                                                                                                                                                                                                                                                                                                                                           |  Não Passou. Todos os casos de empate sao pontuados sem levar em consideraçao as outras rodadas, sempre priorizando o jogador humano.                |
| [RN13] | Mãos                                                                                            | Cada partida contém várias mãos, e cada mão tem 3 rodadas                                                                                                                                                                                                                                                                                                                                                                              | Passou                                                                                                                                               |
| [RN14] | Baralho                                                                                         | O baralho é composto de 40 cartas únicas de baralho espanhol, do 1 ao 12 de cada naipe, excluindo 8 e 9                                                                                                                                                                                                                                                                                                                                | Passou                                                                                                                                               |
| [RN15] | Peso das cartas                                                                                 | Para a disputa de rodadas a sequência do valor das cartas é, do menor para o maior: 4, 5, 6, 7, 10, 11, 12, 1, 2, 3 (de todos os naipes), 7 de ouros, 7 de espadas, 1 de paus e 1 de espadas. Para cálculo de disputas de envido e flor: cada carta do mesmo naipe vale 10 pontos que são somados aos valores individuais de cada carta; cartas com figuras valem 0 e as demais valem seu próprio número (ex: a carta 7 vale 7 pontos) | Passou                                                                                                                                               |

